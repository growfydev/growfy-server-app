generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum CoreRole {
    ADMIN
    USER
}

enum TeamRole {
    TEAM_OWNER
    TEAM_MEMBER
    ANALYST
    EDITOR
    MANAGER
    CONTENT_CREATOR
    CLIENT
    GUEST
}

enum PermissionFlags {
    VIEW
    VIEW_ANALYTICS
    VIEW_INBOX
    VIEW_PLANNER
    VIEW_ADS
    SMARTLINKS
    EDIT
    REPORTS
    INBOX
    ADS
    HASHTAG_TRACKER
    PLANNER
    PLAN_AND_PUBLISH
    PLAN_PENDING_REVIEW
    REVIEW_POSTS
    MANAGEMENT
    BRAND
}

model User {
    id          Int       @id @default(autoincrement())
    name        String
    email       String    @unique
    password    String
    phone       String?
    role        CoreRole  @default(USER)
    otpEnabled  Boolean   @default(false)
    otpVerified Boolean   @default(false)
    otpSecret   String?
    otpAuthURI  String?
    createdAt   DateTime  @default(now())
    updatedAt   DateTime? @updatedAt
    members     Member[]
}

model Member {
    id        Int      @id @default(autoincrement())
    userId    Int
    profileId Int
    role      TeamRole @default(TEAM_OWNER)
    user      User     @relation(fields: [userId], references: [id])
    profile   Profile  @relation(fields: [profileId], references: [id])

    @@unique([userId, profileId])
}

model Profile {
    id      Int      @id @default(autoincrement())
    name    String
    members Member[]
    socials Social[]
}

model Social {
    id         Int      @id @default(autoincrement())
    token      String
    providerId Int
    profileId  Int
    provider   Provider @relation(fields: [providerId], references: [id])
    profile    Profile  @relation(fields: [profileId], references: [id])
}

model Provider {
    id      Int      @id @default(autoincrement())
    name    String
    socials Social[]
}

model Post {
    id         Int       @id @default(autoincrement())
    status     String?
    body       String?
    postTypeId Int?
    taskId     Int       @unique
    postType   PostType? @relation(fields: [postTypeId], references: [id])
    task       Task      @relation(fields: [taskId], references: [id])
}

model Task {
    id     Int    @id @default(autoincrement())
    status String
    postId Int    @unique
    unix   String
    post   Post[]
}

model PostType {
    id    Int    @id @default(autoincrement())
    name  String
    posts Post[]
}

model Permission {
    id        Int                  @id @default(autoincrement())
    name      PermissionFlags      @unique
    roles     CoreRolePermission[]
    teamRoles TeamRolePermission[]
}

model CoreRolePermission {
    id           Int        @id @default(autoincrement())
    coreRole     CoreRole
    permission   Permission @relation(fields: [permissionId], references: [id])
    permissionId Int

    @@unique([coreRole, permissionId])
}

model TeamRolePermission {
    id           Int        @id @default(autoincrement())
    teamRole     TeamRole
    permission   Permission @relation(fields: [permissionId], references: [id])
    permissionId Int

    @@unique([teamRole, permissionId])
}
